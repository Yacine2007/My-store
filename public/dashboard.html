<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - My Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #e63946;
            --warning: #ff9e00;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Custom Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--success);
            z-index: 10000;
            max-width: 400px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .notification-message {
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
            padding: 5px;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #343a40;
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            color: #adb5bd;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #adb5bd;
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: var(--transition);
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.orders { background: var(--primary); }
        .stat-icon.products { background: var(--success); }
        .stat-icon.visitors { background: var(--accent); }
        .stat-icon.revenue { background: var(--warning); }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .section-content {
            padding: 20px;
        }

        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .status-badge.active { background: #d1edff; color: #004085; }
        .status-badge.inactive { background: #f8d7da; color: #721c24; }
        .status-badge.pending { background: #fff3cd; color: #856404; }
        .status-badge.completed { background: #d1edff; color: #004085; }
        .status-badge.cancelled { background: #f8d7da; color: #721c24; }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }

        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .action-group {
            display: flex;
            gap: 5px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #3251d4;
            transform: translateY(-2px);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Login Page */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo img {
            height: 60px;
            object-fit: contain;
        }

        .login-logo h1 {
            margin-top: 10px;
            color: var(--primary);
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        /* Image Preview */
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            object-fit: cover;
        }

        /* Product Images */
        .product-image-table {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 700px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            z-index: 1;
        }

        .modal-title {
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
        }

        /* رفع الصور */
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f8f9fa;
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .upload-area p {
            margin-bottom: 10px;
            color: var(--gray);
        }

        .upload-area small {
            color: #adb5bd;
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .image-preview-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 120px;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: rgba(230, 57, 70, 0.9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            border: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Menu Toggle Button */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
        }

        /* Order Details */
        .order-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-details {
            flex: 1;
        }

        .order-item-price {
            font-weight: 600;
            color: var(--primary);
        }

        /* Delivery Badge */
        .delivery-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .delivery-available { background: #d1edff; color: #004085; }
        .delivery-unavailable { background: #f8d7da; color: #721c24; }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .sidebar {
                width: 70px;
            }
            .sidebar-header h2, .menu-item span {
                display: none;
            }
            .main-content {
                margin-left: 70px;
            }
            .menu-item {
                justify-content: center;
                padding: 15px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
                z-index: 1000;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-header h2, .menu-item span {
                display: block;
            }
            .menu-item {
                justify-content: flex-start;
            }
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .menu-toggle {
                display: block;
            }
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            .user-info {
                align-self: flex-end;
                margin-top: 10px;
            }
            .table-responsive {
                font-size: 0.9rem;
            }
            th, td {
                padding: 8px 10px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .tabs {
                flex-direction: column;
            }
            .tab {
                text-align: center;
            }
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            .header h1 {
                font-size: 1.3rem;
            }
            .section-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            .action-group {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            .header {
                padding: 10px 15px;
            }
            .section-content {
                padding: 15px;
            }
            .stat-card {
                padding: 15px;
            }
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            .user-details {
                display: none;
            }
        }
    </style>


<style>
/* تحسينات الانتقالات للقائمة الجانبية */
.sidebar {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(0);
}

.sidebar.active {
    transform: translateX(0);
    box-shadow: 5px 0 25px rgba(0, 0, 0, 0.3);
}

/* طبقة التعتيم الخلفية للقائمة الجانبية */
.sidebar-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.sidebar-overlay.active {
    display: block;
    opacity: 1;
}

/* تحسينات استجابة إضافية للهواتف */
@media (max-width: 768px) {
    /* تحسينات القائمة الجانبية */
    .sidebar {
        transform: translateX(-100%);
        box-shadow: none;
    }
    
    .sidebar.active {
        transform: translateX(0);
        box-shadow: 5px 0 25px rgba(0, 0, 0, 0.3);
    }
    
    /* تحسينات الهيدر */
    .header {
        position: sticky;
        top: 0;
        z-index: 100;
        margin-bottom: 15px;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
    }
    
    /* تحسينات البطاقات */
    .stat-card {
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 16px;
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
    }
    
    /* تحسينات الجداول */
    .table-responsive {
        border-radius: 12px;
        overflow: hidden;
    }
    
    table {
        font-size: 0.85rem;
    }
    
    th, td {
        padding: 10px 8px;
        white-space: nowrap;
    }
    
    /* تحسينات النماذج */
    .form-control {
        font-size: 16px; /* منع التكبير في iOS */
        padding: 14px 12px;
    }
    
    /* تحسينات الأزرار */
    .btn {
        padding: 14px 20px;
        border-radius: 12px;
        font-size: 1rem;
    }
    
    .action-btn {
        padding: 8px 12px;
        margin: 2px;
    }
    
    /* تحسينات المودال */
    .modal-content {
        margin: 10px;
        padding: 20px;
        border-radius: 20px;
        max-height: 85vh;
    }
    
    /* تحسينات التبويبات */
    .tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 5px;
    }
    
    .tab {
        flex-shrink: 0;
        padding: 12px 16px;
    }
}

@media (max-width: 480px) {
    /* تحسينات إضافية للشاشات الصغيرة */
    .main-content {
        padding: 10px 8px;
    }
    
    .content-section {
        border-radius: 16px;
        margin-bottom: 15px;
    }
    
    .section-content {
        padding: 15px;
    }
    
    .stats-grid {
        gap: 12px;
    }
    
    .stat-card {
        padding: 12px;
    }
    
    .stat-icon {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
    }
    
    .stat-info h3 {
        font-size: 1.5rem;
    }
    
    /* تحسينات الإشعارات */
    .notification {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
    
    /* تحسينات رفع الملفات */
    .upload-area {
        padding: 25px 15px;
    }
    
    .upload-area i {
        font-size: 2.5rem;
    }
}

@media (max-width: 360px) {
    /* تحسينات للشاشات الصغيرة جداً */
    .main-content {
        padding: 8px 5px;
    }
    
    .header {
        padding: 12px 15px;
    }
    
    .header h1 {
        font-size: 1.2rem;
    }
    
    .stat-card {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
    
    .action-group {
        flex-direction: column;
        gap: 5px;
    }
    
    .action-btn {
        width: 100%;
        justify-content: center;
    }
}

/* تحسينات اللمس والتفاعل */
.menu-item, .tab, .btn, .action-btn {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}

/* تحسينات التمرير السلس */
.main-content, .sidebar, .modal-content {
    -webkit-overflow-scrolling: touch;
}

/* تحسينات الأداء */
.stat-card, .content-section, .header {
    will-change: transform;
    backface-visibility: hidden;
}

/* تحسينات الظلال للهواتف */
@media (max-width: 768px) {
    .content-section, .header, .stat-card {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
}

/* تحسينات الشريط السفلي الآمن للهواتف الحديثة */
@supports(padding: max(0px)) {
    .main-content {
        padding-left: max(8px, env(safe-area-inset-left));
        padding-right: max(8px, env(safe-area-inset-right));
        padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
}

/* تحسينات التحميل */
.loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* تحسينات الظهور التدريجي */
.fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* تحسينات إضافية للواجهة الناعمة */
.menu-item, .tab, .btn {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.menu-item:active, .tab:active, .btn:active {
    transform: scale(0.98);
}

/* تحسينات الصور في الجداول للهواتف */
@media (max-width: 768px) {
    .product-image-table {
        width: 40px;
        height: 40px;
    }
}

/* تحسينات الحالة النشطة للعناصر */
.menu-item:active {
    background: rgba(255, 255, 255, 0.15);
}

.btn:active {
    transform: translateY(1px);
}
</style>

    
</head>
<body>
    <!-- Custom Notification -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon">
                <i class="fas fa-check"></i>
            </div>
            <div class="notification-message">
                <strong id="notificationTitle">Success</strong>
                <p id="notificationMessage">Operation completed successfully</p>
            </div>
            <button class="notification-close" id="notificationClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <img id="loginLogo" src="" alt="Store Logo" onerror="this.src='https://via.placeholder.com/60x60?text=LOGO'">
                <h1>My Store</h1>
            </div>
            <h2 class="login-title">Admin Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>My Store</h2>
                <p>Admin Dashboard</p>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-tab="dashboard-tab">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-tab="products-tab">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </div>
                <div class="menu-item" data-tab="orders-tab">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </div>
                <div class="menu-item" data-tab="settings-tab">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="menu-item" data-tab="profile-tab">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </div>
                <a href="http://my-storewin.great-site.net/" class="menu-item" target="_blank">
                    <i class="fas fa-store"></i>
                    <span>View Store</span>
                </a>
                <div class="menu-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Dashboard</h1>
                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name" id="adminName">Admin User</div>
                        <div class="user-role">System Administrator</div>
                    </div>
                    <div class="user-avatar" id="adminAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon orders">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="ordersCount">0</h3>
                            <p>Completed Orders</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon products">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="productsCount">0</h3>
                            <p>Total Products</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon visitors">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="visitorsCount">0</h3>
                            <p>Visitors</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="revenueAmount">0 DA</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h2>Recent Orders</h2>
                    </div>
                    <div class="section-content">
                        <div class="table-responsive">
                            <table id="recentOrdersTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Orders will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="products-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Products Management</h2>
                        <button class="btn btn-primary" id="addProductBtn">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                    <div class="section-content">
                        <div class="table-responsive">
                            <table id="productsTable">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>Category</th>
                                        <th>Delivery</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Products will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="orders-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Orders Management</h2>
                    </div>
                    <div class="section-content">
                        <div class="table-responsive">
                            <table id="ordersTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Phone</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Delivery</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Orders will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Store Settings</h2>
                    </div>
                    <div class="section-content">
                        <form id="settingsForm">
                            <div class="tabs">
                                <div class="tab active" data-tab="general">General</div>
                                <div class="tab" data-tab="theme">Theme</div>
                                <div class="tab" data-tab="contact">Contact</div>
                                <div class="tab" data-tab="social">Social Media</div>
                            </div>

                            <!-- General Settings -->
                            <div id="general" class="tab-content active">
                                <div class="form-group">
                                    <label for="storeName">Store Name</label>
                                    <input type="text" id="storeName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="heroTitle">Hero Title</label>
                                    <input type="text" id="heroTitle" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="heroDescription">Hero Description</label>
                                    <textarea id="heroDescription" class="form-control"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="currency">Currency</label>
                                        <select id="currency" class="form-control">
                                            <option value="DA">DA</option>
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="language">Language</label>
                                        <select id="language" class="form-control">
                                            <option value="en">English</option>
                                            <option value="ar">Arabic</option>
                                            <option value="fr">French</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="storeLogo">Store Logo</label>
                                    <div class="upload-area" id="logoUploadArea">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to upload store logo</p>
                                        <small>Recommended: 200x60px PNG or JPG</small>
                                        <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
                                    </div>
                                    <input type="hidden" id="storeLogo">
                                    <div class="image-preview-container">
                                        <img id="logoPreview" class="image-preview" style="display: none;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="storeStatus">Store Status</label>
                                    <select id="storeStatus" class="form-control">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Theme Settings -->
                            <div id="theme" class="tab-content">
                                <div class="form-group">
                                    <label>Primary Color</label>
                                    <div class="color-picker">
                                        <input type="color" id="primaryColor" class="color-input">
                                        <input type="text" id="primaryColorText" class="form-control" placeholder="#4361ee">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Secondary Color</label>
                                    <div class="color-picker">
                                        <input type="color" id="secondaryColor" class="color-input">
                                        <input type="text" id="secondaryColorText" class="form-control" placeholder="#3a0ca3">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Accent Color</label>
                                    <div class="color-picker">
                                        <input type="color" id="accentColor" class="color-input">
                                        <input type="text" id="accentColorText" class="form-control" placeholder="#f72585">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Background Color</label>
                                    <div class="color-picker">
                                        <input type="color" id="backgroundColor" class="color-input">
                                        <input type="text" id="backgroundColorText" class="form-control" placeholder="#ffffff">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Text Color</label>
                                    <div class="color-picker">
                                        <input type="color" id="textColor" class="color-input">
                                        <input type="text" id="textColorText" class="form-control" placeholder="#212529">
                                    </div>
                                </div>
                            </div>

                            <!-- Contact Settings -->
                            <div id="contact" class="tab-content">
                                <div class="form-group">
                                    <label for="contactPhone">Phone Number</label>
                                    <input type="text" id="contactPhone" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="contactWhatsapp">WhatsApp Number</label>
                                    <input type="text" id="contactWhatsapp" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="contactEmail">Email Address</label>
                                    <input type="email" id="contactEmail" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="contactAddress">Store Address</label>
                                    <textarea id="contactAddress" class="form-control"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="workingHours">Working Hours</label>
                                        <input type="text" id="workingHours" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="workingDays">Working Days</label>
                                        <input type="text" id="workingDays" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <!-- Social Media Settings -->
                            <div id="social" class="tab-content">
                                <div class="form-group">
                                    <label for="facebookUrl">Facebook Page URL</label>
                                    <input type="url" id="facebookUrl" class="form-control" placeholder="https://facebook.com/yourpage">
                                </div>
                                <div class="form-group">
                                    <label for="twitterUrl">Twitter URL</label>
                                    <input type="url" id="twitterUrl" class="form-control" placeholder="https://twitter.com/yourprofile">
                                </div>
                                <div class="form-group">
                                    <label for="instagramUrl">Instagram URL</label>
                                    <input type="url" id="instagramUrl" class="form-control" placeholder="https://instagram.com/yourprofile">
                                </div>
                                <div class="form-group">
                                    <label for="youtubeUrl">YouTube URL</label>
                                    <input type="url" id="youtubeUrl" class="form-control" placeholder="https://youtube.com/yourchannel">
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </form>
                    </div>
                </div>



<!-- إضافة هذا الكود في نهاية قسم Settings Tab في dashboard.html -->
<div class="content-section" style="border-left: 4px solid #e63946; margin-top: 30px;">
    <div class="section-header">
        <h2 style="color: #e63946;">
            <i class="fas fa-exclamation-triangle"></i> Danger Zone
        </h2>
    </div>
    <div class="section-content">
        <div style="background: #fff5f5; border: 1px solid #fed7d7; border-radius: 8px; padding: 20px;">
            <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px;">
                <div style="color: #e53e3e; font-size: 24px;">
                    <i class="fas fa-radiation"></i>
                </div>
                <div>
                    <h3 style="color: #c53030; margin-bottom: 8px;">Reset Store Data</h3>
                    <p style="color: #742a2a; line-height: 1.5; margin-bottom: 15px;">
                        This action will permanently delete all products, orders, analytics data, and reset store settings to default. 
                        <strong>This action cannot be undone!</strong>
                    </p>
                    <div style="background: #fed7d7; border-left: 4px solid #e53e3e; padding: 12px 15px; border-radius: 4px;">
                        <div style="display: flex; align-items: center; gap: 10px; color: #742a2a;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span><strong>Warning:</strong> All your data will be lost including customer orders and product information.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                        Type "RESET" to confirm:
                    </label>
                    <input 
                        type="text" 
                        id="resetConfirmInput" 
                        style="width: 200px; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 16px; text-transform: uppercase;"
                        placeholder="Type RESET here"
                    >
                    <div style="font-size: 12px; color: #718096; margin-top: 5px;">
                        Must be typed in uppercase letters
                    </div>
                </div>
                
                <button 
                    id="resetStoreBtn" 
                    style="
                        background: #e53e3e;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 6px;
                        font-weight: 600;
                        cursor: not-allowed;
                        opacity: 0.6;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        width: fit-content;
                    "
                    disabled
                >
                    <i class="fas fa-bomb"></i>
                    Reset Store Data
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// JavaScript لإعادة ضبط المتجر
document.addEventListener('DOMContentLoaded', function() {
    const resetConfirmInput = document.getElementById('resetConfirmInput');
    const resetStoreBtn = document.getElementById('resetStoreBtn');
    let resetTimeout = null;

    // التحقق من صحة الإدخال
    resetConfirmInput.addEventListener('input', function(e) {
        const value = e.target.value.trim();
        const isConfirmed = value === 'RESET';
        
        if (isConfirmed) {
            resetStoreBtn.style.background = '#c53030';
            resetStoreBtn.style.cursor = 'pointer';
            resetStoreBtn.style.opacity = '1';
            resetStoreBtn.disabled = false;
        } else {
            resetStoreBtn.style.background = '#e53e3e';
            resetStoreBtn.style.cursor = 'not-allowed';
            resetStoreBtn.style.opacity = '0.6';
            resetStoreBtn.disabled = true;
        }
    });

    // إعادة الضبط
    resetStoreBtn.addEventListener('click', async function() {
        if (resetConfirmInput.value.trim() !== 'RESET') {
            return;
        }

        // تأكيد نهائي
        const finalConfirm = confirm(`🚨 FINAL WARNING 🚨\n\nYou are about to:\n• Delete ALL products\n• Delete ALL orders\n• Reset ALL analytics\n• Reset store settings\n• Keep admin profile\n\nThis action is PERMANENT and cannot be undone!\n\nClick OK to proceed or Cancel to abort.`);
        
        if (!finalConfirm) {
            return;
        }

        // إظهار تحميل
        resetStoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
        resetStoreBtn.disabled = true;

        try {
            const response = await fetch(`${API_BASE_URL}/reset-data`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            });

            const result = await response.json();

            if (result.success) {
                // إعادة تعيين الحقول
                resetConfirmInput.value = '';
                resetStoreBtn.innerHTML = '<i class="fas fa-check"></i> Reset Complete!';
                resetStoreBtn.style.background = '#38a169';
                
                // إظهار إشعار النجاح
                showNotification('Store Reset', 'All data has been reset successfully! The page will reload in 3 seconds.', 'success');
                
                // إعادة تحميل الصفحة بعد 3 ثواني
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
                
            } else {
                throw new Error(result.error || 'Reset failed');
            }
        } catch (error) {
            console.error('Reset error:', error);
            resetStoreBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Reset Failed';
            resetStoreBtn.style.background = '#e53e3e';
            showNotification('Reset Failed', 'Failed to reset store data: ' + error.message, 'error');
            
            // إعادة تعيين الزر بعد 3 ثواني
            setTimeout(() => {
                resetStoreBtn.innerHTML = '<i class="fas fa-bomb"></i> Reset Store Data';
                resetStoreBtn.disabled = false;
            }, 3000);
        }
    });

    // منع النسخ واللصق في حقل التأكيد
    resetConfirmInput.addEventListener('paste', function(e) {
        e.preventDefault();
        showNotification('Action Not Allowed', 'Please type "RESET" manually to confirm.', 'warning');
    });

    // منع الكتابة بالأحرف الصغيرة
    resetConfirmInput.addEventListener('keypress', function(e) {
        const char = String.fromCharCode(e.keyCode || e.which);
        if (char >= 'a' && char <= 'z') {
            e.preventDefault();
            showNotification('Uppercase Required', 'Please type in UPPERCASE letters only.', 'warning');
        }
    });
});

// إضافة CSS إضافي للتنسيق
const style = document.createElement('style');
style.textContent = `
    #resetConfirmInput:focus {
        border-color: #e53e3e !important;
        box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1) !important;
        outline: none;
    }
    
    #resetStoreBtn:hover:not(:disabled) {
        background: #9b2c2c !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
    }
    
    #resetStoreBtn:active:not(:disabled) {
        transform: translateY(0);
    }
    
    .reset-confirm-required {
        animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);
</script>


                
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Profile Settings</h2>
                    </div>
                    <div class="section-content">
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="adminNameInput">Admin Name</label>
                                <input type="text" id="adminNameInput" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="adminRole">Role</label>
                                <input type="text" id="adminRole" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label for="adminAvatar">Profile Picture</label>
                                <div class="upload-area" id="avatarUploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload profile picture</p>
                                    <small>Recommended: 200x200px PNG or JPG</small>
                                    <input type="file" id="avatarFileInput" accept="image/*" style="display: none;">
                                </div>
                                <input type="hidden" id="adminAvatar">
                                <div class="image-preview-container">
                                    <img id="avatarPreview" class="image-preview" style="display: none;">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Profile
                            </button>
                        </form>

                        <div class="content-section" style="margin-top: 20px;">
                            <div class="section-header">
                                <h2>Change Password</h2>
                            </div>
                            <div class="section-content">
                                <form id="passwordForm">
                                    <div class="form-group">
                                        <label for="currentPassword">Current Password</label>
                                        <input type="password" id="currentPassword" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <input type="password" id="newPassword" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmPassword">Confirm New Password</label>
                                        <input type="password" id="confirmPassword" class="form-control" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-key"></i> Change Password
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="productModalTitle" class="modal-title">Add Product</h2>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="productPrice">Price (DA)</label>
                        <input type="number" id="productPrice" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="productQuantity">Quantity</label>
                        <input type="number" id="productQuantity" class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="productCategory">Category</label>
                    <input type="text" id="productCategory" class="form-control" placeholder="Electronics, Fashion, etc.">
                </div>
                
                <!-- Delivery Availability -->
                <div class="form-group">
                    <label for="productDelivery">Delivery Available</label>
                    <select id="productDelivery" class="form-control">
                        <option value="true" selected>Yes</option>
                        <option value="false">No (Pickup Only)</option>
                    </select>
                </div>
                
                <!-- قسم رفع الصور -->
                <div class="form-group">
                    <label>Product Images</label>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop images here or click to browse</p>
                        <small>Supported formats: JPG, PNG, GIF (Max: 10MB)</small>
                        <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                    <div class="image-preview-container" id="imagePreviewContainer">
                        <!-- معاينة الصور تظهر هنا -->
                    </div>
                    <textarea id="productImages" class="form-control" rows="3" placeholder="Image URLs will appear here automatically" style="display: none;"></textarea>
                </div>

                <div class="form-group">
                    <label for="productStatus">Status</label>
                    <select id="productStatus" class="form-control">
                        <option value="true" selected>Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Save Product</button>
            </form>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">Order Details #<span id="orderDetailsId"></span></h2>
            <div class="order-details">
                <div class="form-group">
                    <label><strong>Customer Information</strong></label>
                    <p>Name: <span id="orderCustomerName"></span></p>
                    <p>Phone: <span id="orderCustomerPhone"></span></p>
                    <p>Address: <span id="orderCustomerAddress"></span></p>
                    <p>Delivery Option: <span id="orderDeliveryOption"></span></p>
                </div>
                
                <div class="form-group">
                    <label><strong>Order Items</strong></label>
                    <div id="orderItemsList">
                        <!-- Order items will be populated here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label><strong>Order Summary</strong></label>
                    <div class="order-summary">
                        <div class="price-row total">
                            <span>Total Amount:</span>
                            <span id="orderTotalAmount">0 DA</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><strong>Special Notes</strong></label>
                    <p id="orderNotes">No special notes provided.</p>
                </div>
                
                <div class="form-group">
                    <label for="orderStatusSelect">Order Status</label>
                    <select id="orderStatusSelect" class="form-control">
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                
                <button type="button" class="btn btn-primary" id="updateOrderStatusBtn">
                    <i class="fas fa-save"></i> Update Status
                </button>
            </div>
        </div>
    </div>
<script>
    // نظام اكتشاف API تلقائي محسن
    function getApiBaseUrl() {
        // قائمة بالخوادم المحتملة مرتبة بالأولوية
        const apiEndpoints = [
            'https://my-store-p63u.onrender.com/api',
            'http://localhost:3000/api'
        ];

        // إذا كنا في بيئة التطوير، جرب المحلي أولاً
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            apiEndpoints.unshift('http://localhost:3000/api');
        }

        return apiEndpoints[0]; // استخدم الأول كافتراضي
    }

    const API_BASE_URL = getApiBaseUrl();
    console.log('🚀 Using API Base URL:', API_BASE_URL);

    // Global variables
    let authToken = '';
    let currentUser = {};
    let storeSettings = {};
    let products = [];
    let orders = [];
    let uploadedImages = [];
    let currentOrderId = null;
    let loadingTimeout = null;

    // DOM Elements
    const loginPage = document.getElementById('loginPage');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('loginForm');
    const notification = document.getElementById('notification');
    const notificationClose = document.getElementById('notificationClose');
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menuToggle');
    const logoutBtn = document.getElementById('logoutBtn');
    const productModal = document.getElementById('productModal');
    const orderDetailsModal = document.getElementById('orderDetailsModal');
    const closeModal = document.querySelectorAll('.close-modal');
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const productImages = document.getElementById('productImages');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const logoUploadArea = document.getElementById('logoUploadArea');
    const logoFileInput = document.getElementById('logoFileInput');
    const avatarUploadArea = document.getElementById('avatarUploadArea');
    const avatarFileInput = document.getElementById('avatarFileInput');

    // نظام التحميل الذكي
    function startLoading(message = 'Loading...') {
        console.log('🔄', message);
        loadingTimeout = setTimeout(() => {
            showNotification('Warning', 'Taking longer than expected. Please wait...', 'warning');
        }, 8000);
    }

    function stopLoading() {
        if (loadingTimeout) {
            clearTimeout(loadingTimeout);
            loadingTimeout = null;
        }
    }

    // طلبات Fetch محسنة
    async function safeFetch(url, options = {}) {
        startLoading(`Fetching: ${url}`);
        
        try {
            // إضافة headers افتراضية
            const fetchOptions = {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            };

            const response = await fetch(url, fetchOptions);
            stopLoading();

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return response;
        } catch (error) {
            stopLoading();
            console.error('❌ Fetch error:', error);
            throw error;
        }
    }

    // Show notification محسن
    function showNotification(title, message, type = 'success') {
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationIcon = notification.querySelector('.notification-icon');
        
        notificationTitle.textContent = title;
        notificationMessage.textContent = message;
        
        const colors = {
            success: '#4cc9f0',
            error: '#e63946',
            warning: '#ff9e00',
            info: '#4361ee'
        };
        
        notificationIcon.style.background = colors[type] || colors.success;
        notificationIcon.innerHTML = type === 'error' ? '<i class="fas fa-exclamation"></i>' : 
                                   type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' :
                                   type === 'info' ? '<i class="fas fa-info"></i>' :
                                   '<i class="fas fa-check"></i>';
        
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    // Close notification
    notificationClose.addEventListener('click', () => {
        notification.classList.remove('show');
    });

    // فحص صحة API محسن
    async function checkAPIHealth() {
        try {
            console.log('🔍 Checking API health...');
            const response = await fetch(`${API_BASE_URL}/health`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const health = await response.json();
                console.log('✅ API is healthy:', health);
                return true;
            } else {
                console.error('❌ API health check failed');
                return false;
            }
        } catch (error) {
            console.error('❌ API connection failed:', error);
            return false;
        }
    }

    // Initialize the dashboard محسن
    async function initDashboard() {
        console.log('🎯 Initializing dashboard...');
        
        // فحص اتصال API أولاً
        const isAPIHealthy = await checkAPIHealth();
        
        if (!isAPIHealthy) {
            showNotification('Connection Error', 
                'Cannot connect to server. Please check:\n• Internet connection\n• Server status\n• API endpoints', 
                'error');
            showLoginPage();
            return;
        }

        const savedToken = localStorage.getItem('adminToken');
        if (savedToken) {
            authToken = savedToken;
            console.log('🔑 Token found, verifying...');
            await verifyToken();
        } else {
            console.log('🔐 No token found, showing login');
            showLoginPage();
        }

        setupEventListeners();
        console.log('✅ Dashboard initialized successfully');
    }

    // Show login page
    function showLoginPage() {
        loginPage.style.display = 'flex';
        dashboard.style.display = 'none';
        // تحميل إعدادات المتجر للشعار
        loadStoreSettingsForLogin();
    }

    // تحميل إعدادات المتجر لصفحة Login
    async function loadStoreSettingsForLogin() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/settings`);
            if (response.ok) {
                const settings = await response.json();
                if (settings.logo) {
                    document.getElementById('loginLogo').src = settings.logo;
                }
            }
        } catch (error) {
            console.log('⚠️ Could not load store settings for login');
        }
    }

    // Show dashboard
    function showDashboard() {
        loginPage.style.display = 'none';
        dashboard.style.display = 'flex';
        loadDashboardData();
    }

    // Verify token محسن
    async function verifyToken() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/user/profile`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                const userData = await response.json();
                currentUser = userData;
                console.log('✅ Token verified, user:', userData.name);
                showDashboard();
            } else {
                console.error('❌ Token verification failed');
                localStorage.removeItem('adminToken');
                showLoginPage();
                showNotification('Session Expired', 'Please login again', 'warning');
            }
        } catch (error) {
            console.error('❌ Token verification error:', error);
            localStorage.removeItem('adminToken');
            showLoginPage();
            showNotification('Connection Error', 'Failed to verify session', 'error');
        }
    }

    // Setup event listeners محسن
    function setupEventListeners() {
        console.log('🔧 Setting up event listeners...');

        // Login form
        loginForm.addEventListener('submit', handleLogin);

        // Menu toggle
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Logout
        logoutBtn.addEventListener('click', handleLogout);

        // Tab navigation
        document.querySelectorAll('.menu-item[data-tab]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const tabId = item.getAttribute('data-tab');
                switchTab(tabId);
                
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            });
        });

        // Settings tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                switchSettingsTab(tabId);
            });
        });

        // Add product button
        document.getElementById('addProductBtn').addEventListener('click', () => {
            openProductModal();
        });

        // Forms
        document.getElementById('settingsForm').addEventListener('submit', handleSettingsSave);
        document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
        document.getElementById('passwordForm').addEventListener('submit', handlePasswordChange);
        document.getElementById('productForm').addEventListener('submit', handleProductSave);

        // Color pickers
        setupColorPickers();

        // Close modal events
        closeModal.forEach(closeBtn => {
            closeBtn.addEventListener('click', () => {
                productModal.style.display = 'none';
                orderDetailsModal.style.display = 'none';
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target === productModal) {
                productModal.style.display = 'none';
            }
            if (e.target === orderDetailsModal) {
                orderDetailsModal.style.display = 'none';
            }
        });

        // أحداث رفع الصور للمنتجات
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', handleFileSelect);

        // أحداث السحب والإفلات للمنتجات
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // أحداث رفع لوجو المتجر
        logoUploadArea.addEventListener('click', () => {
            logoFileInput.click();
        });

        logoFileInput.addEventListener('change', (e) => {
            handleLogoUpload(e.target.files[0]);
        });

        // أحداث رفع صورة البروفايل
        avatarUploadArea.addEventListener('click', () => {
            avatarFileInput.click();
        });

        avatarFileInput.addEventListener('change', (e) => {
            handleAvatarUpload(e.target.files[0]);
        });

        // Update order status
        document.getElementById('updateOrderStatusBtn').addEventListener('click', updateOrderStatusFromModal);

        console.log('✅ Event listeners setup complete');
    }

    // Handle login محسن
    async function handleLogin(e) {
        e.preventDefault();
        const password = document.getElementById('password').value;

        if (!password) {
            showNotification('Error', 'Please enter password', 'error');
            return;
        }

        try {
            const response = await safeFetch(`${API_BASE_URL}/login`, {
                method: 'POST',
                body: JSON.stringify({ password })
            });

            const result = await response.json();

            if (result.success) {
                authToken = result.token;
                currentUser = result.user;
                localStorage.setItem('adminToken', authToken);
                console.log('✅ Login successful, user:', result.user.name);
                showDashboard();
                showNotification('Welcome!', `Hello ${result.user.name}`, 'success');
            } else {
                showNotification('Error', result.error || 'Invalid password', 'error');
            }
        } catch (error) {
            console.error('❌ Login error:', error);
            showNotification('Login Failed', 'Please check your connection and try again', 'error');
        }
    }

    // Handle logout
    function handleLogout(e) {
        e.preventDefault();
        authToken = '';
        currentUser = {};
        localStorage.removeItem('adminToken');
        console.log('👋 User logged out');
        showLoginPage();
        showNotification('Goodbye!', 'You have been logged out successfully', 'info');
    }

    // Switch between main tabs
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        document.getElementById(tabId).classList.add('active');

        const headerTitle = document.querySelector('.header h1');
        switch(tabId) {
            case 'dashboard-tab':
                headerTitle.textContent = 'Dashboard';
                loadDashboardStats();
                break;
            case 'products-tab':
                headerTitle.textContent = 'Products Management';
                loadProducts();
                break;
            case 'orders-tab':
                headerTitle.textContent = 'Orders Management';
                loadOrders();
                break;
            case 'settings-tab':
                headerTitle.textContent = 'Store Settings';
                loadSettings();
                break;
            case 'profile-tab':
                headerTitle.textContent = 'Profile Settings';
                loadProfile();
                break;
        }
    }

    // Switch between settings tabs
    function switchSettingsTab(tabId) {
        document.querySelectorAll('#settings-tab .tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        document.querySelectorAll('#settings-tab .tab').forEach(tab => {
            tab.classList.remove('active');
        });

        document.getElementById(tabId).classList.add('active');
        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
    }

    // Load dashboard data محسن
    async function loadDashboardData() {
        console.log('📊 Loading dashboard data...');
        await Promise.all([
            loadDashboardStats(),
            loadRecentOrders(),
            loadUserInfo()
        ]);
        console.log('✅ Dashboard data loaded');
    }

    // Load dashboard statistics محسن
    async function loadDashboardStats() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/dashboard/stats`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                const stats = await response.json();
                document.getElementById('ordersCount').textContent = stats.orders;
                document.getElementById('productsCount').textContent = stats.products;
                document.getElementById('visitorsCount').textContent = stats.visitors;
                document.getElementById('revenueAmount').textContent = stats.revenue + ' DA';
                console.log('📈 Stats loaded:', stats);
            }
        } catch (error) {
            console.error('❌ Error loading dashboard stats:', error);
            showNotification('Error', 'Failed to load statistics', 'error');
        }
    }

    // Load recent orders محسن
    async function loadRecentOrders() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/orders`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                orders = await response.json();
                renderRecentOrders();
                console.log('📦 Orders loaded:', orders.length);
            }
        } catch (error) {
            console.error('❌ Error loading orders:', error);
        }
    }

    // Render recent orders
    function renderRecentOrders() {
        const tbody = document.querySelector('#recentOrdersTable tbody');
        tbody.innerHTML = '';

        const recentOrders = orders.slice(-5).reverse();

        if (recentOrders.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; color: #6c757d;">
                        No orders yet
                    </td>
                </tr>
            `;
            return;
        }

        recentOrders.forEach(order => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>#${order.id}</td>
                <td>${order.customerName}</td>
                <td>${order.total} DA</td>
                <td><span class="status-badge ${order.status}">${order.status}</span></td>
                <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                <td>
                    <button class="action-btn btn-primary" onclick="viewOrderDetails(${order.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Load products محسن
    async function loadProducts() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/products`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                products = await response.json();
                renderProducts();
                console.log('📦 Products loaded:', products.length);
            }
        } catch (error) {
            console.error('❌ Error loading products:', error);
            showNotification('Error', 'Failed to load products', 'error');
        }
    }

    // Render products
    function renderProducts() {
        const tbody = document.querySelector('#productsTable tbody');
        tbody.innerHTML = '';

        if (products.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; color: #6c757d;">
                        No products yet. Click "Add Product" to get started.
                    </td>
                </tr>
            `;
            return;
        }

        products.forEach(product => {
            const imageUrl = product.images && product.images.length > 0 
                ? product.images[0]
                : 'https://via.placeholder.com/50x50?text=No+Image';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <img src="${imageUrl}" alt="${product.name}" class="product-image-table" 
                         onerror="this.src='https://via.placeholder.com/50x50?text=No+Image'">
                </td>
                <td>${product.name}</td>
                <td>${product.price} DA</td>
                <td>${product.quantity}</td>
                <td>${product.category || 'Uncategorized'}</td>
                <td>
                    <span class="delivery-badge ${product.deliveryAvailable ? 'delivery-available' : 'delivery-unavailable'}">
                        ${product.deliveryAvailable ? 'Available' : 'Pickup Only'}
                    </span>
                </td>
                <td>
                    <span class="status-badge ${product.status ? 'active' : 'inactive'}">
                        ${product.status ? 'Active' : 'Inactive'}
                    </span>
                </td>
                <td>
                    <div class="action-group">
                        <button class="action-btn btn-primary" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn btn-danger" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Load orders محسن
    async function loadOrders() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/orders`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                orders = await response.json();
                renderOrders();
                console.log('📋 Orders loaded:', orders.length);
            }
        } catch (error) {
            console.error('❌ Error loading orders:', error);
            showNotification('Error', 'Failed to load orders', 'error');
        }
    }

    // Render orders
    function renderOrders() {
        const tbody = document.querySelector('#ordersTable tbody');
        tbody.innerHTML = '';

        if (orders.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; color: #6c757d;">
                        No orders yet
                    </td>
                </tr>
            `;
            return;
        }

        orders.forEach(order => {
            const itemsCount = order.items ? order.items.length : 0;
            const itemsText = itemsCount === 1 ? '1 item' : `${itemsCount} items`;
            const deliveryText = order.deliveryOption === 'delivery' ? 'Delivery' : 'Pickup';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>#${order.id}</td>
                <td>${order.customerName}</td>
                <td>${order.phone}</td>
                <td>${itemsText}</td>
                <td>${order.total} DA</td>
                <td>${deliveryText}</td>
                <td>
                    <select onchange="updateOrderStatus(${order.id}, this.value)" class="form-control">
                        <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                        <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                    </select>
                </td>
                <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                <td>
                    <button class="action-btn btn-primary" onclick="viewOrderDetails(${order.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Load settings محسن
    async function loadSettings() {
        try {
            const response = await safeFetch(`${API_BASE_URL}/settings`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                storeSettings = await response.json();
                populateSettingsForm();
                console.log('⚙️ Settings loaded');
            }
        } catch (error) {
            console.error('❌ Error loading settings:', error);
            showNotification('Error', 'Failed to load settings', 'error');
        }
    }

    // Populate settings form
    function populateSettingsForm() {
        // General settings
        document.getElementById('storeName').value = storeSettings.storeName || '';
        document.getElementById('heroTitle').value = storeSettings.heroTitle || '';
        document.getElementById('heroDescription').value = storeSettings.heroDescription || '';
        document.getElementById('currency').value = storeSettings.currency || 'DA';
        document.getElementById('language').value = storeSettings.language || 'en';
        document.getElementById('storeLogo').value = storeSettings.logo || '';
        
        // Show logo preview
        if (storeSettings.logo) {
            document.getElementById('logoPreview').src = storeSettings.logo;
            document.getElementById('logoPreview').style.display = 'block';
            document.getElementById('loginLogo').src = storeSettings.logo;
        }
        
        document.getElementById('storeStatus').value = storeSettings.storeStatus ? 'true' : 'false';

        // Theme settings
        if (storeSettings.theme) {
            document.getElementById('primaryColor').value = storeSettings.theme.primary;
            document.getElementById('primaryColorText').value = storeSettings.theme.primary;
            document.getElementById('secondaryColor').value = storeSettings.theme.secondary;
            document.getElementById('secondaryColorText').value = storeSettings.theme.secondary;
            document.getElementById('accentColor').value = storeSettings.theme.accent;
            document.getElementById('accentColorText').value = storeSettings.theme.accent;
            document.getElementById('backgroundColor').value = storeSettings.theme.background || '#ffffff';
            document.getElementById('backgroundColorText').value = storeSettings.theme.background || '#ffffff';
            document.getElementById('textColor').value = storeSettings.theme.text || '#212529';
            document.getElementById('textColorText').value = storeSettings.theme.text || '#212529';
        }

        // Contact settings
        if (storeSettings.contact) {
            document.getElementById('contactPhone').value = storeSettings.contact.phone || '';
            document.getElementById('contactWhatsapp').value = storeSettings.contact.whatsapp || '';
            document.getElementById('contactEmail').value = storeSettings.contact.email || '';
            document.getElementById('contactAddress').value = storeSettings.contact.address || '';
            document.getElementById('workingHours').value = storeSettings.contact.workingHours || '';
            document.getElementById('workingDays').value = storeSettings.contact.workingDays || '';
        }

        // Social media settings
        if (storeSettings.social) {
            document.getElementById('facebookUrl').value = storeSettings.social.facebook || '';
            document.getElementById('twitterUrl').value = storeSettings.social.twitter || '';
            document.getElementById('instagramUrl').value = storeSettings.social.instagram || '';
            document.getElementById('youtubeUrl').value = storeSettings.social.youtube || '';
        }
    }

    // Load profile محسن بشكل كبير
    async function loadProfile() {
        try {
            console.log('👤 Loading profile data...');
            const response = await safeFetch(`${API_BASE_URL}/user/profile`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                const userData = await response.json();
                console.log('✅ Profile data received:', userData);
                
                // تحديث الحقول
                document.getElementById('adminNameInput').value = userData.name || '';
                document.getElementById('adminRole').value = userData.role || 'System Administrator';
                document.getElementById('adminAvatar').value = userData.avatar || '';
                
                // تحديث معاينة الصورة
                const avatarPreview = document.getElementById('avatarPreview');
                if (userData.avatar) {
                    avatarPreview.src = userData.avatar;
                    avatarPreview.style.display = 'block';
                    console.log('🖼️ Avatar loaded');
                } else {
                    avatarPreview.style.display = 'none';
                }

                // تحديث معلومات المستخدم في الواجهة
                loadUserInfo();
                
            } else {
                console.error('❌ Failed to load profile data');
                showNotification('Error', 'Failed to load profile data', 'error');
            }
        } catch (error) {
            console.error('❌ Error loading profile:', error);
            showNotification('Error', 'Failed to load profile: ' + error.message, 'error');
        }
    }

    // Load user info
    function loadUserInfo() {
        if (currentUser && currentUser.name) {
            document.getElementById('adminName').textContent = currentUser.name;
            const adminAvatar = document.getElementById('adminAvatar');
            if (currentUser.avatar) {
                adminAvatar.innerHTML = `<img src="${currentUser.avatar}" alt="${currentUser.name}">`;
            } else {
                adminAvatar.innerHTML = '<i class="fas fa-user"></i>';
            }
            console.log('👤 User info updated:', currentUser.name);
        }
    }

    // Setup color pickers
    function setupColorPickers() {
        // Primary color
        document.getElementById('primaryColor').addEventListener('input', (e) => {
            document.getElementById('primaryColorText').value = e.target.value;
        });
        document.getElementById('primaryColorText').addEventListener('input', (e) => {
            document.getElementById('primaryColor').value = e.target.value;
        });

        // Secondary color
        document.getElementById('secondaryColor').addEventListener('input', (e) => {
            document.getElementById('secondaryColorText').value = e.target.value;
        });
        document.getElementById('secondaryColorText').addEventListener('input', (e) => {
            document.getElementById('secondaryColor').value = e.target.value;
        });

        // Accent color
        document.getElementById('accentColor').addEventListener('input', (e) => {
            document.getElementById('accentColorText').value = e.target.value;
        });
        document.getElementById('accentColorText').addEventListener('input', (e) => {
            document.getElementById('accentColor').value = e.target.value;
        });

        // Background color
        document.getElementById('backgroundColor').addEventListener('input', (e) => {
            document.getElementById('backgroundColorText').value = e.target.value;
        });
        document.getElementById('backgroundColorText').addEventListener('input', (e) => {
            document.getElementById('backgroundColor').value = e.target.value;
        });

        // Text color
        document.getElementById('textColor').addEventListener('input', (e) => {
            document.getElementById('textColorText').value = e.target.value;
        });
        document.getElementById('textColorText').addEventListener('input', (e) => {
            document.getElementById('textColor').value = e.target.value;
        });
    }

    // Handle settings save محسن
    async function handleSettingsSave(e) {
        e.preventDefault();
        
        const settings = {
            storeName: document.getElementById('storeName').value,
            heroTitle: document.getElementById('heroTitle').value,
            heroDescription: document.getElementById('heroDescription').value,
            currency: document.getElementById('currency').value,
            language: document.getElementById('language').value,
            logo: document.getElementById('storeLogo').value,
            storeStatus: document.getElementById('storeStatus').value === 'true',
            theme: {
                primary: document.getElementById('primaryColor').value,
                secondary: document.getElementById('secondaryColor').value,
                accent: document.getElementById('accentColor').value,
                background: document.getElementById('backgroundColor').value,
                text: document.getElementById('textColor').value
            },
            contact: {
                phone: document.getElementById('contactPhone').value,
                whatsapp: document.getElementById('contactWhatsapp').value,
                email: document.getElementById('contactEmail').value,
                address: document.getElementById('contactAddress').value,
                workingHours: document.getElementById('workingHours').value,
                workingDays: document.getElementById('workingDays').value
            },
            social: {
                facebook: document.getElementById('facebookUrl').value,
                twitter: document.getElementById('twitterUrl').value,
                instagram: document.getElementById('instagramUrl').value,
                youtube: document.getElementById('youtubeUrl').value
            }
        };

        try {
            const response = await safeFetch(`${API_BASE_URL}/settings`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(settings)
            });

            const result = await response.json();

            if (result.success) {
                console.log('✅ Settings saved successfully');
                showNotification('Success', 'Settings saved successfully!');
                // إعادة تحميل الإعدادات للتأكد
                setTimeout(() => loadSettings(), 1000);
            } else {
                console.error('❌ Failed to save settings:', result.error);
                showNotification('Error', result.error || 'Failed to save settings', 'error');
            }
        } catch (error) {
            console.error('❌ Error saving settings:', error);
            showNotification('Error', 'Failed to save settings: ' + error.message, 'error');
        }
    }

    // Handle profile update محسن بشكل كبير
    async function handleProfileUpdate(e) {
        e.preventDefault();
        
        const profileData = {
            name: document.getElementById('adminNameInput').value,
            avatar: document.getElementById('adminAvatar').value
        };

        // التحقق من البيانات
        if (!profileData.name.trim()) {
            showNotification('Error', 'Please enter your name', 'error');
            return;
        }

        try {
            console.log('💾 Saving profile data...', profileData);
            
            const response = await safeFetch(`${API_BASE_URL}/user/profile`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(profileData)
            });

            const result = await response.json();

            if (result.success) {
                console.log('✅ Profile saved successfully:', result.user);
                currentUser = result.user;
                
                // تحديث الواجهة فوراً
                loadUserInfo();
                
                showNotification('Success', 'Profile updated successfully!');
                
                // إعادة تحميل البيانات للتأكد من التحديث
                setTimeout(() => {
                    loadProfile();
                }, 500);
                
            } else {
                console.error('❌ Failed to save profile:', result.error);
                showNotification('Error', result.error || 'Failed to update profile', 'error');
            }
        } catch (error) {
            console.error('❌ Error updating profile:', error);
            showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
        }
    }

    // Handle password change محسن
    async function handlePasswordChange(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!currentPassword || !newPassword || !confirmPassword) {
            showNotification('Error', 'All password fields are required', 'error');
            return;
        }

        if (newPassword !== confirmPassword) {
            showNotification('Error', 'New passwords do not match', 'error');
            return;
        }

        if (newPassword.length < 6) {
            showNotification('Error', 'New password must be at least 6 characters', 'error');
            return;
        }

        try {
            const response = await safeFetch(`${API_BASE_URL}/change-password`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    currentPassword,
                    newPassword
                })
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Success', 'Password changed successfully!');
                document.getElementById('passwordForm').reset();
                console.log('🔑 Password changed successfully');
            } else {
                showNotification('Error', result.error || 'Failed to change password', 'error');
            }
        } catch (error) {
            console.error('❌ Error changing password:', error);
            showNotification('Error', 'Failed to change password: ' + error.message, 'error');
        }
    }

    // معالجة اختيار الملفات
    function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
    }

    // معالجة الملفات
    async function handleFiles(files) {
        const validFiles = Array.from(files).filter(file => {
            const isValidType = file.type.startsWith('image/');
            const isValidSize = file.size <= 10 * 1024 * 1024; // 10MB
            
            if (!isValidType) {
                showNotification('Error', 'Only image files are allowed', 'error');
                return false;
            }
            if (!isValidSize) {
                showNotification('Error', 'File size must be less than 10MB', 'error');
                return false;
            }
            
            return true;
        });

        for (const file of validFiles) {
            await uploadFile(file);
        }
    }

    // رفع ملف واحد
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('image', file);

        try {
            progressBar.style.display = 'block';
            progressFill.style.width = '50%';
            
            const response = await fetch(`${API_BASE_URL}/upload`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                if (result.success) {
                    uploadedImages.push(result.imageUrl);
                    updateImagePreviews();
                    updateProductImagesTextarea();
                    showNotification('Success', 'Image uploaded successfully');
                    progressFill.style.width = '100%';
                    console.log('🖼️ Image uploaded:', result.imageUrl);
                } else {
                    throw new Error('Upload failed');
                }
            } else {
                throw new Error('Upload failed');
            }
        } catch (error) {
            console.error('❌ Upload error:', error);
            showNotification('Error', 'Failed to upload image: ' + error.message, 'error');
        } finally {
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
            }, 1000);
        }
    }

    // رفع لوجو المتجر
    async function handleLogoUpload(file) {
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
            showNotification('Error', 'Only image files are allowed', 'error');
            return;
        }
        
        if (file.size > 10 * 1024 * 1024) {
            showNotification('Error', 'File size must be less than 10MB', 'error');
            return;
        }

        const formData = new FormData();
        formData.append('image', file);

        try {
            const response = await fetch(`${API_BASE_URL}/upload`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                if (result.success) {
                    document.getElementById('storeLogo').value = result.imageUrl;
                    document.getElementById('logoPreview').src = result.imageUrl;
                    document.getElementById('logoPreview').style.display = 'block';
                    showNotification('Success', 'Logo uploaded successfully');
                    console.log('🏪 Logo uploaded:', result.imageUrl);
                }
            }
        } catch (error) {
            console.error('❌ Logo upload error:', error);
            showNotification('Error', 'Failed to upload logo', 'error');
        }
    }

    // رفع صورة البروفايل
    async function handleAvatarUpload(file) {
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
            showNotification('Error', 'Only image files are allowed', 'error');
            return;
        }
        
        if (file.size > 10 * 1024 * 1024) {
            showNotification('Error', 'File size must be less than 10MB', 'error');
            return;
        }

        const formData = new FormData();
        formData.append('image', file);

        try {
            const response = await fetch(`${API_BASE_URL}/upload`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                if (result.success) {
                    document.getElementById('adminAvatar').value = result.imageUrl;
                    document.getElementById('avatarPreview').src = result.imageUrl;
                    document.getElementById('avatarPreview').style.display = 'block';
                    showNotification('Success', 'Profile picture uploaded successfully');
                    console.log('👤 Avatar uploaded:', result.imageUrl);
                }
            }
        } catch (error) {
            console.error('❌ Avatar upload error:', error);
            showNotification('Error', 'Failed to upload profile picture', 'error');
        }
    }

    // تحديث معاينة الصور
    function updateImagePreviews() {
        imagePreviewContainer.innerHTML = '';
        
        uploadedImages.forEach((imageUrl, index) => {
            const previewItem = document.createElement('div');
            previewItem.className = 'image-preview-item';
            previewItem.innerHTML = `
                <img src="${imageUrl}" alt="Preview ${index + 1}">
                <button type="button" class="image-preview-remove" onclick="removeImage(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            imagePreviewContainer.appendChild(previewItem);
        });
    }

    // إزالة صورة
    function removeImage(index) {
        uploadedImages.splice(index, 1);
        updateImagePreviews();
        updateProductImagesTextarea();
    }

    // تحديث حقل روابط الصور
    function updateProductImagesTextarea() {
        productImages.value = uploadedImages.join('\n');
    }

    // Open product modal
    function openProductModal(product = null) {
        const modal = document.getElementById('productModal');
        const title = document.getElementById('productModalTitle');
        const form = document.getElementById('productForm');

        // إعادة تعيين الصور المرفوعة
        uploadedImages = [];
        updateImagePreviews();
        updateProductImagesTextarea();

        if (product) {
            title.textContent = 'Edit Product';
            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.name;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productQuantity').value = product.quantity;
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productDelivery').value = product.deliveryAvailable ? 'true' : 'false';
            
            // تحميل الصور الحالية للمنتج
            if (product.images && product.images.length > 0) {
                uploadedImages = [...product.images];
                updateImagePreviews();
                updateProductImagesTextarea();
            }
            
            document.getElementById('productStatus').value = product.status ? 'true' : 'false';
        } else {
            title.textContent = 'Add Product';
            form.reset();
            document.getElementById('productId').value = '';
            // وضع افتراضي Active
            document.getElementById('productStatus').value = 'true';
            document.getElementById('productDelivery').value = 'true';
        }

        modal.style.display = 'flex';
    }

    // Handle product save محسن
    async function handleProductSave(e) {
        e.preventDefault();
        
        const productData = {
            name: document.getElementById('productName').value,
            description: document.getElementById('productDescription').value,
            price: parseFloat(document.getElementById('productPrice').value),
            quantity: parseInt(document.getElementById('productQuantity').value),
            category: document.getElementById('productCategory').value,
            deliveryAvailable: document.getElementById('productDelivery').value === 'true',
            status: document.getElementById('productStatus').value === 'true',
            images: uploadedImages
        };

        const productId = document.getElementById('productId').value;

        try {
            const url = productId 
                ? `${API_BASE_URL}/products/${productId}`
                : `${API_BASE_URL}/products`;
            
            const method = productId ? 'PUT' : 'POST';

            const response = await safeFetch(url, {
                method: method,
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(productData)
            });

            const result = await response.json();

            if (result.success) {
                showNotification('Success', 'Product saved successfully!');
                document.getElementById('productModal').style.display = 'none';
                await loadProducts();
                console.log('✅ Product saved:', result.product);
            } else {
                showNotification('Error', result.error || 'Failed to save product', 'error');
            }
        } catch (error) {
            console.error('❌ Error saving product:', error);
            showNotification('Error', 'Failed to save product: ' + error.message, 'error');
        }
    }

    // Edit product
    function editProduct(productId) {
        const product = products.find(p => p.id === productId);
        if (product) {
            openProductModal(product);
        }
    }

    // Delete product محسن
    async function deleteProduct(productId) {
        if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
            return;
        }

        try {
            const response = await safeFetch(`${API_BASE_URL}/products/${productId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (response.ok) {
                showNotification('Success', 'Product deleted successfully!');
                await loadProducts();
                console.log('🗑️ Product deleted:', productId);
            } else {
                showNotification('Error', 'Failed to delete product', 'error');
            }
        } catch (error) {
            console.error('❌ Error deleting product:', error);
            showNotification('Error', 'Failed to delete product: ' + error.message, 'error');
        }
    }

    // View order details
    function viewOrderDetails(orderId) {
        const order = orders.find(o => o.id === orderId);
        if (!order) return;

        currentOrderId = orderId;
        
        document.getElementById('orderDetailsId').textContent = order.id;
        document.getElementById('orderCustomerName').textContent = order.customerName;
        document.getElementById('orderCustomerPhone').textContent = order.phone;
        document.getElementById('orderCustomerAddress').textContent = order.address;
        document.getElementById('orderDeliveryOption').textContent = order.deliveryOption === 'delivery' ? 'Home Delivery' : 'Store Pickup';
        document.getElementById('orderTotalAmount').textContent = order.total + ' DA';
        document.getElementById('orderNotes').textContent = order.description || 'No special notes provided.';
        document.getElementById('orderStatusSelect').value = order.status;

        // عرض العناصر
        const itemsList = document.getElementById('orderItemsList');
        itemsList.innerHTML = '';
        
        if (order.items && order.items.length > 0) {
            order.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'order-item';
                itemElement.innerHTML = `
                    <div class="order-item-details">
                        <strong>${item.productName}</strong><br>
                        <small>Quantity: ${item.quantity} × ${item.unitPrice} DA</small>
                    </div>
                    <div class="order-item-price">
                        ${item.total} DA
                    </div>
                `;
                itemsList.appendChild(itemElement);
            });
        }

        orderDetailsModal.style.display = 'flex';
    }

    // Update order status from modal
    async function updateOrderStatusFromModal() {
        const status = document.getElementById('orderStatusSelect').value;
        
        try {
            const response = await safeFetch(`${API_BASE_URL}/orders/${currentOrderId}/status`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ status })
            });

            if (response.ok) {
                showNotification('Success', 'Order status updated successfully!');
                orderDetailsModal.style.display = 'none';
                loadOrders();
                loadRecentOrders();
                loadDashboardStats();
                console.log('📦 Order status updated:', currentOrderId, status);
            } else {
                showNotification('Error', 'Failed to update order status', 'error');
            }
        } catch (error) {
            console.error('❌ Error updating order status:', error);
            showNotification('Error', 'Failed to update order status: ' + error.message, 'error');
        }
    }

    // Update order status from table
    async function updateOrderStatus(orderId, status) {
        try {
            const response = await safeFetch(`${API_BASE_URL}/orders/${orderId}/status`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ status })
            });

            if (response.ok) {
                showNotification('Success', 'Order status updated successfully!');
                loadOrders();
                loadRecentOrders();
                loadDashboardStats();
                console.log('📦 Order status updated:', orderId, status);
            } else {
                showNotification('Error', 'Failed to update order status', 'error');
            }
        } catch (error) {
            console.error('❌ Error updating order status:', error);
            showNotification('Error', 'Failed to update order status: ' + error.message, 'error');
        }
    }

    // Initialize the dashboard when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🎉 Dashboard page loaded');
        initDashboard().catch(error => {
            console.error('💥 Failed to initialize dashboard:', error);
            showNotification('Initialization Error', 'Failed to load dashboard. Please refresh the page.', 'error');
        });
    });

    // جعل الدوال متاحة globally للاستخدام في onclick
    window.viewOrderDetails = viewOrderDetails;
    window.updateOrderStatus = updateOrderStatus;
    window.editProduct = editProduct;
    window.deleteProduct = deleteProduct;
    window.removeImage = removeImage;
    window.changeProductImage = function(imageUrl, element) {
        document.getElementById('mainProductImage').src = imageUrl;
        document.querySelectorAll('.product-thumbnail').forEach(thumb => {
            thumb.classList.remove('active');
        });
        element.classList.add('active');
    };
    window.changeOrderProductImage = function(imageUrl, element) {
        document.getElementById('orderMainImage').src = imageUrl;
        document.querySelectorAll('#orderProductGallery .product-thumbnail').forEach(thumb => {
            thumb.classList.remove('active');
        });
        element.classList.add('active');
    };
</script>


<script>
// تحسينات القائمة الجانبية للهواتف
function setupMobileSidebar() {
    const sidebarOverlay = document.createElement('div');
    sidebarOverlay.className = 'sidebar-overlay';
    sidebarOverlay.id = 'sidebarOverlay';
    document.body.appendChild(sidebarOverlay);
    
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menuToggle');
    const sidebarOverlayElement = document.getElementById('sidebarOverlay');
    
    // إغلاق القائمة بالنقر على الخلفية
    sidebarOverlayElement.addEventListener('click', () => {
        sidebar.classList.remove('active');
        sidebarOverlayElement.classList.remove('active');
        document.body.style.overflow = 'auto';
    });
    
    // زر القائمة
    menuToggle.addEventListener('click', () => {
        const isActive = sidebar.classList.toggle('active');
        sidebarOverlayElement.classList.toggle('active');
        document.body.style.overflow = isActive ? 'hidden' : 'auto';
    });
    
    // إغلاق القائمة عند النقر على عنصر قائمة
    document.querySelectorAll('.sidebar-menu .menu-item').forEach(item => {
        item.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('active');
                sidebarOverlayElement.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });
    });
}

// تحسينات أداء اللمس
function setupTouchOptimizations() {
    // منع التكبير المزدوج على الأزرار
    document.addEventListener('touchstart', function() {}, { passive: true });
    
    // تحسين استجابة النقر
    document.addEventListener('touchmove', function(e) {
        if (e.scale !== 1) {
            e.preventDefault();
        }
    }, { passive: false });
    
    // تحسينات للأزرار والعناصر القابلة للنقر
    document.querySelectorAll('.btn, .action-btn, .menu-item, .tab').forEach(element => {
        element.style.cursor = 'pointer';
    });
}

// تحسينات المودال للهواتف
function setupMobileModals() {
    const modals = document.querySelectorAll('.modal');
    
    modals.forEach(modal => {
        modal.addEventListener('touchmove', function(e) {
            e.stopPropagation();
        }, { passive: false });
    });
}

// تحسينات التمرير للجداول
function setupTableScroll() {
    const tables = document.querySelectorAll('.table-responsive');
    
    tables.forEach(table => {
        let isScrolling;
        table.addEventListener('scroll', function() {
            window.clearTimeout(isScrolling);
            table.classList.add('scrolling');
            isScrolling = setTimeout(function() {
                table.classList.remove('scrolling');
            }, 150);
        });
    });
}

// تحسينات تحميل الصور
function setupImageLoading() {
    const images = document.querySelectorAll('img');
    
    images.forEach(img => {
        // إضافة تأثير تحميل للصور
        if (!img.complete) {
            img.style.opacity = '0';
            img.addEventListener('load', function() {
                this.style.transition = 'opacity 0.3s ease';
                this.style.opacity = '1';
            });
        }
    });
}

// تحسينات الأداء العام
function setupPerformanceOptimizations() {
    // تقليل إعادة التصيير
    let resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
            // إعادة حساب العناصر عند انتهاء التغيير
            document.querySelectorAll('.stat-card, .content-section').forEach(el => {
                el.style.willChange = 'auto';
            });
        }, 250);
    });
    
    // تحسين الذاكرة
    window.addEventListener('beforeunload', function() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
        });
    });
}

// تحسينات لوحة المفاتيح للهواتف
function setupKeyboardHandling() {
    document.addEventListener('focusin', function(e) {
        if (window.innerWidth <= 768) {
            setTimeout(() => {
                e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }
    });
}

// تهيئة جميع التحسينات
function initMobileOptimizations() {
    setupMobileSidebar();
    setupTouchOptimizations();
    setupMobileModals();
    setupTableScroll();
    setupImageLoading();
    setupPerformanceOptimizations();
    setupKeyboardHandling();
    
    console.log('📱 Mobile optimizations initialized');
}

// كشف حجم الشاشة وتعديل السلوك
function handleViewportChanges() {
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    function checkViewport() {
        if (window.innerWidth > 768) {
            if (sidebar) sidebar.classList.remove('active');
            if (sidebarOverlay) sidebarOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    }
    
    // التحقق عند تغيير الحجم
    window.addEventListener('resize', checkViewport);
    
    // التحقق عند تغيير الاتجاه
    window.addEventListener('orientationchange', function() {
        setTimeout(checkViewport, 300);
    });
}

// إضافة CSS ديناميكي للتحسينات
function addDynamicStyles() {
    const style = document.createElement('style');
    style.textContent = `
        .table-responsive.scrolling {
            pointer-events: none;
        }
        
        .table-responsive.scrolling * {
            pointer-events: auto;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                transform: translateY(0);
                transition: transform 0.3s ease;
            }
            
            .modal.show .modal-content {
                transform: translateY(0);
            }
        }
        
        /* تحسينات اللمس للإطارات */
        .stat-card, .content-section {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    `;
    document.head.appendChild(style);
}

// تهيئة التحسينات عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    // الانتظار حتى يكتمل تحميل الصفحة
    setTimeout(() => {
        initMobileOptimizations();
        handleViewportChanges();
        addDynamicStyles();
    }, 100);
});

// جعل الدوال متاحة globally إذا لزم الأمر
window.initMobileOptimizations = initMobileOptimizations;
window.handleViewportChanges = handleViewportChanges;

// تحسينات إضافية للتفاعلات
document.addEventListener('DOMContentLoaded', function() {
    // تحسينات النقر المزدوج
    let lastTap = 0;
    document.addEventListener('touchend', function(e) {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;
        if (tapLength < 500 && tapLength > 0) {
            e.preventDefault();
        }
        lastTap = currentTime;
    });
    
    // تحسينات التمرير السلس
    document.querySelectorAll('.sidebar, .modal-content').forEach(element => {
        element.addEventListener('touchstart', function() {
            this.style.overflowY = 'hidden';
        });
        
        element.addEventListener('touchend', function() {
            this.style.overflowY = 'auto';
        });
    });
});
</script>
    

    
</body>
</html>



